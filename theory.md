# 蒙特卡罗方法采样算法

&emsp;&emsp;蒙特卡罗方法(`Monte Carlo Simulation`)是一种随机模拟(或者统计模拟)方法。

&emsp;&emsp;给定统计样本集，如何估计产生这个样本集的随机变量概率密度函数,是我们比较熟悉的概率密度估计问题。
求解概率密度估计问题的常用方法是最大似然估计、最大后验估计等。但是,我们思考概率密度估计问题的逆问题:给定一个概率分布`p(x)`，如何让计算机生成满足这个概率分布的样本。
这个问题就是统计模拟中研究的重要问题–采样(`Sampling`)。本文将重点介绍其中两种重要的采样算法：`MCMC(Markov Chain Monte Carlo)`算法和`Gibbs Sampling`算法。

## Sampling

&emsp;&emsp;一般而言均匀分布`Uniform(0,1)`的样本是相对容易生成的。 通过线性同余发生器可以生成伪随机数，我们用确定性算法生成`[0,1]`之间的伪随机数序列后，
这些序列的各种统计指标和均匀分布`Uniform(0,1)`的理论计算结果非常接近。这样的伪随机序列就有比较好的统计性质，可以被当成真实的随机数使用。线性同余随机数生成器如下:

$$x_{n+1}=(ax_n+c)~\textrm{mod}~m$$

&emsp;&emsp;式中`aa`，`cc`，`mm`是数学推导出的合适的常数。这种算法产生的下一个随机数完全依赖当前的随机数，当随机数序列足够大的时候，随机数会出现重复子序列的情况。
当然，也有很多更加先进的随机数产生算法出现，比如`numpy`用的是 `Mersenne Twister` 等。根据上面的算法现在我们有了均匀分布的随机数，但是如何产生满足其他分布下的随机数呢？

&emsp;&emsp;首先我们来看一个简单的例子，假设我们想对下面的二项分布进行采样:

$$P(X=0)=0.5 ~,~ P(X=1)=0.5$$

&emsp;&emsp;我们如何采样得到$X$的值。我们会很毫不费力地想到“抛硬币”，如果硬币正面朝上，则$X=1$，否则，$X=0$。那计算机怎么做，使用随机数生成器生成0到1之间的随机数$r$，
如果$r<0.5$，则$X=1$，否则，$X=0$。当分布是多项式分布时:

$$P(X=i)=1/6 ~,~ i\in{1,2,...,6}$$

&emsp;&emsp;这也很简单，让算机生成0到1之间的随机数$r$，把0到1等分成6个子区间，$r$落在哪个区间，$X$就取值为那个区间的编号。我们再考虑更复杂的情况，假设分布是多元随机变量分布:

$$P(X_1,X_2,...,X_n)$$

&emsp;&emsp;当然这种情况下也有容易解决的例子，比如随机变量都是独立的情形:

$$P(X_1,X_2,...,X_n)=P(X_1)P(X_2)...P(X_n)$$

&emsp;&emsp;我们可以利用前面的算法对每个变量单独进行采样。但是问题并不总是这么简单，当$P(X)$的形式很复杂，或者$P(X)$是个高维的分布且不能分解的时候，样本的生成就可能很困难了。
此时就需要使用一些更加复杂的随机模拟的方法来生成样本。而本节中将要重点介绍的 `MCMC` 算法和 `Gibbs Sampling` 算法就是最常用的两种，这两个方法在现代贝叶斯分析中被广泛使用。
要了解这两个算法，我们首先要对马尔科夫链的平稳分布的性质有基本的认识。

## 马尔科夫链及其平稳分布

&emsp;&emsp;马尔科夫链的数学定义如下:

$$P(X_{t+1}=x|X_t,X_{t-1},...)=P(X_{t+1}=x|X_t)$$

&emsp;&emsp;也就是说前一个状态只与当前状态有关，而与其他状态无关，马尔科夫链体现的是状态空间的转换关系，下一个状态只决定于当前的状态。

&emsp;&emsp;**马尔科夫链定理:**如果一个非周期马尔科夫链具有转移概率矩阵$P$，且它的任何两个状态是连通的，那么$\lim_{n \rightarrow \infty}P_{ij}^{n}$存在且与$i$无关，
记$\lim_{n \rightarrow \infty}P_{ij}^{n} = \pi(j)$,有

- 1 $\lim_{n \rightarrow \infty}P^{n} =\left(
   \begin{align}
   \pi(1)  \pi(2) \ldots \pi(j) \ldots \\\
   \pi(1) \pi(2)  \ldots \pi(j) \ldots \\\
   \vdots \vdots \vdots \vdots \vdots \\\
   \end{align}
   \right)$

- 2 $\pi(j) = \sum_{i=0}^{\infty}\pi(i)P_{ij}$

&emsp;&emsp;$\pi$是方程$\pi~P=\pi$的唯一非负解,其中$\pi=[\pi(1),\pi(2),\ldots,\pi(j),\ldots],~\sum_{i=0}^{\infty}\pi(i)=1$,$/pi$称为马尔科夫链的平稳分布。





